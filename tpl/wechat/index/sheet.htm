<!-- FIXME: 这里先这样写，获取全部接口。以后考再虑是否要每次都获取全部的接口功能，把这段代码移动到header.htm中 -->
<script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
<script type="text/javascript">
    var __imgRoot = '{:$imgRoot}';
    var __taskId = {:$taskId};
    var __paperId = {:$paperId};
    var __userId = {:$userId};
    var __answerId = 0;
    // FIXME: 应该将photo与photosList写成一个类
    var __photosList = [];
    wx.config({
        debug: false,
        appId: '{:$signPackage["appid"]}',
        timestamp: {:$signPackage["timestamp"]},
        nonceStr: '{:$signPackage["noncestr"]}',
        signature: '{:$signPackage["signature"]}',
        jsApiList : [ 'checkJsApi', 'onMenuShareTimeline',
                'onMenuShareAppMessage', 'onMenuShareQQ',
                'onMenuShareWeibo', 'hideMenuItems',
                'showMenuItems', 'hideAllNonBaseMenuItem',
                'showAllNonBaseMenuItem', 'translateVoice',
                'startRecord', 'stopRecord', 'onRecordEnd',
                'playVoice', 'pauseVoice', 'stopVoice',
                'uploadVoice', 'downloadVoice', 'chooseImage',
                'previewImage', 'uploadImage', 'downloadImage',
                'getNetworkType', 'openLocation', 'getLocation',
                'hideOptionMenu', 'showOptionMenu', 'closeWindow',
                'scanQRCode', 'chooseWXPay',
                'openProductSpecificView', 'addCard', 'chooseCard',
                'openCard', 'getLocalImgData' ]
    });
</script>

<!-- 主体页面 -->
<div class="wx_view">
    <div class="wx_col_item" id="card_book">
        <div class="wx_row_item card_book">
            <div class="card" v-for="photo in photosList">
                <!-- FIXME: 目前的所有图片都是通过微信压缩，然后获取的原图。这样早晚会流量爆炸的... -->
                <div class="card_body" v-bind:style="{'background-image':'url('+__imgRoot+photo.imgUrl+')'}">
                </div>
                <div class="card_footer dropup" >
                    <div class="card_title">{{ photo['imgContent'] }}</div>
                    <button class="card_dropdown_btn" id="dLabel" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <span class="glyphicon glyphicon-option-vertical" aria-hidden="true"></span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dLabel" style="min-width: 10vw;">
                        <li v-on:click="modifyPhoto(photo.imgUrl)"><i>修改</i></li>
                        <li v-on:click="deletePhoto(photo.imgUrl)"><i>删除</i></li>
                    </ul>
                </div>
            </div>
            <div class="card add_card_btn" id="add_card_btn" v-on:click="addPhoto()">
                <i class="fa fa-plus" style="font-size: 64px;"></i>
                <div>点击添加图片</div>
            </div>
        </div>
        <div class="wx_row_item bottom_area">
            <button type="button" class="btn btn-default" v-on:click="goBack()">返回</button>
            <button type="button" class="btn btn-primary" v-on:click="sumbitSheet()">提交</button>
        </div>
    </div>
</div>

<!-- 添加卡片提示框 -->
<!-- FIXME: 现在是混搭布局，需要以后换成flex... -->
<div class="modal" id="add_photo_modal" tabindex="-1" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content" style="width: 100%;">
            <div class="modal-header" style="width: 90%; margin-left: auto; margin-right: auto; padding: 2%;">
                <strong style="font-size: 20px;">提交图片</strong>
            </div>
            <div class="modal-body" style="width: 90%; margin-left: auto; margin-right: auto; padding: 2%; text-align: center;">
                <img id="add_photo_modal_img" v-bind:src="imgUrl" style="max-width: 40vw; max-height: 40vw; padding-bottom: 2%; margin: 2%;">
                <input type="text" class="form-control" id="add_photo_modal_img_content" placeholder="请添加备注" v-bind:value="imgContent">
            </div>
            <div class="modal-footer flex-item flex-row" style="width: 100%; padding: 0px; text-align: center;">
                <div class="modal-footer-left_btn" id="add_photo_cancel" data-dismiss="modal" style="height: 100%; width: 100%; border-right: 0.5px solid #e5e5e5; padding: 3%">取消</div>
                <div class="modal-footer-right_btn" id="add_photo_submit" style="height: 100%; width: 100%; border-left: 0.5px solid #e5e5e5; padding: 3%;" v-on:click="updatePhoto()">提交</div>
            </div>
        </div>
    </div>
</div>

<!-- 修改卡片提示框 -->
<!-- FIXME: 现在是混搭布局，需要以后换成flex... -->
<div class="modal" id="modify_photo_modal" tabindex="-1" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content" style="width: 100%;">
            <div class="modal-header" style="width: 90%; margin-left: auto; margin-right: auto; padding: 2%;">
                <strong style="font-size: 20px;">修改备注信息</strong>
            </div>
            <div class="modal-body" style="width: 90%; margin-left: auto; margin-right: auto; padding: 2%; text-align: center;">
                <img id="modify_photo_modal_img" v-bind:src="__imgRoot+photo.imgUrl" style="max-width: 40vw; max-height: 40vw; padding-bottom: 2%; margin: 2%;">
                <input type="text" class="form-control" id="modify_photo_modal_img_content" placeholder="请添加备注" v-bind:value="photo.imgContent">
            </div>
            <div class="modal-footer flex-item flex-row" style="width: 100%; padding: 0px; text-align: center;">
                <div class="modal-footer-left_btn" id="modify_photo_cancel" data-dismiss="modal" style="height: 100%; width: 100%; border-right: 0.5px solid #e5e5e5; padding: 3%">取消</div>
                <div class="modal-footer-right_btn" id="modify_photo_submit" style="height: 100%; width: 100%; border-left: 0.5px solid #e5e5e5; padding: 3%;" v-on:click="modifyPhotoContent()">修改</div>
            </div>
        </div>
    </div>
</div>
