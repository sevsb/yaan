<div id="page-wrapper">
    <div class="clear">
    <h3>任务列表 -- 项目名称：{:$project_title}
    <a href='?admin/task/new&muffinid={:$muffinid}'><button class='btn btn-success' style='display:inline-block; float: right;'>新建任务</button></a>
    </h3>
    <hr>
    <?php
    //var_dump($wechatusers);
    //$ret = strpos('北京市市辖区','北京市');
    //var_dump($ret);
    
    $show_status = array('未领取', '已领取', '审核失败' ,'任务完成');
    if (!empty($tasks)) {
        foreach ($tasks as $task) {
            $muffinid = $task->muffinid();
            $taskid = $task->id();
            $title = $task->title();
            $address = $task->address();
            $content = $task->content();
            $wechat_userid = $task->wechat_userid();
            $location = $task->location();
            $location = json_decode($location);
            $province = $location->province->title;
            $city = $location->city->title;
            $district = $location->district->title;
            $location_show = $province . " " . $city ." " . $district;
            $status = $task->status();
            $status_show = $show_status[$status];
        ?>
            <div class='task_elf' taskid='{:$taskid}' muffinid='{:$muffinid}'>
                <div class='task_info'>
                    <div class='task_info_right'>
                        <div class='title'>任务名称：{:$title}</div>
                        <div class='location'>所属地址：{:$location_show}</div>
                        <div class='address'>详细地址：{:$address}</div>
                        <div class='content'>信息备注：{:$content}</div>
                        <div class='content'>当前状态：{:$status_show}</div>
                        <?php
                        if (!empty($wechat_userid)) {
                            $wechat_user = wechatuser::create($wechat_userid);
                            $face = $wechat_user->face();
                            $nick = $wechat_user->nick();
                            ?>
                            <div class=''>
                                <div style='display: inline-block;vertical-align: top;'>调查人员：</div>
                                <div style='display: inline-block;'>
                                    <div class='center-block'><img style='width:80px;' src='{:$face}'></div>
                                    <div class='text-center'>{:$nick}</div>
                                </div>
                            </div>
                            <?php
                        }
                        ?>
                        <!--<div class='btn btn-default'>审核任务</div>-->
                        <div>
                            <div class='btn btn-default accept_btn' data-toggle="modal" data-target="#accept_modal">分派任务</div>
                            <a href='?admin/task/new&taskid={:$muffinid}'><div class='btn btn-primary'>编辑任务</div></a>
                            <div class='btn btn-danger del_btn' data-toggle="modal" data-target="#myModal">删除任务</div>
                        </div>
                    </div>
                </div>
            </div>
        <?php
        }
    } else{
        ?>
        
        <div>此项目下暂时无任务</div>
        
        <?php
    }
    ?>
    </div>
</div>

<!-- Modal     data-toggle="modal" data-target="#myModal"   -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">提示！</h4>
      </div>
      <div class="modal-body">
        确认是要删除任务吗？
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
        <button type="button" class="btn btn-danger do_del">确认删除</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal     data-toggle="modal" data-target="#myModal"   -->
<div class="modal fade" id="accept_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">想要分派给哪个调查员？</h4>
      </div>
      <div class="modal-body">
        <?php
        if (!empty($wechatusers)) {
            foreach ($wechatusers as $wechatuser) {
                $face = $wechatuser->face();
                $nick = $wechatuser->nick();
                $userid = $wechatuser->id();
                ?>
                <div class='investigator_div' userid="{:$userid}">
                    <div class='center-block'><img style='width:80px;' src='{:$face}'></div>
                    <div class='text-center'>{:$nick}</div>
                </div>
                <?php
            }
        }
        ?>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger cancel_accept">撤消分派任务</button>
        <!--<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>-->
        <button type="button" class="btn btn-success do_accept">确认分派</button>
      </div>
    </div>
  </div>
</div>
